<html t:type="layout" title="${message:title}" instructions="${message:instructions}"
	helpurl="${message:helpurl}" xmlns:t="http://tapestry.apache.org/schema/tapestry_5_3.xsd"
	xmlns:p="tapestry:parameter">

	<t:if test="stock">
		<p:else>
			${message:no-stock}
		</p:else>
		<table class="kvtable">
			<tr>
				<th>${message:asset-label}:</th>
				<td>
					<t:summaryvalue stock="stock" />
				</td>
			</tr>
			<tr>
				<th>${message:id-label}:</th>
				<td>
					<t:pagelink page="edit/StockEditor" context="${stock.id}">${stock.id}
					</t:pagelink>
				</td>
			</tr>
			<tr>
				<th>${message:units-label}:</th>
				<td>${stock.unitCount}</td>
			</tr>
			<t:if test="stock.comment">
				<tr>
					<th>${message:comment-label}:</th>
					<td>${stock.comment}</td>
				</tr>
			</t:if>
		</table>

		<p />
		<t:form t:id="splitForm">
			<fieldset class="form-wrapper">
				<legend>
					<span class="fieldset-legend">${message:splitheading}</span>
				</legend>
				<div class="fieldset-wrapper">
					<t:if test="stock.liquidated">${message:already-liquidated}</t:if>
					<div class="fieldset-description"></div>
					<t:errors />

					<t:label for="sizeField" />
					:
					<t:textfield class="numerical" t:id="sizeField"
						t:label="${message:splitlabel}" value="size" size="6" />
				  	&nbsp;
					<t:submit id="split" type="submit" value="${message:split}" />
				</div>
			</fieldset>
		</t:form>
	</t:if>

	<t:if test="stocks">
		<p />
		${message:mergetitle}
		<table t:type="grid" model="ledgerModel" source="stocks"
			rowsPerPage="40" pagerPosition="top"
			reorder="asset,id,acquired,buyprice,units,liquidated,sellprice" row="wrappedstock"
			exclude="profit,variant,name,location,comment" add="actions">
			<p:assetCell>
				<t:SummaryValue stock="wrappedstock.stock" />
			</p:assetCell>
			<p:idCell>
				<t:pagelink page="edit/StockEditor" context="${wrappedstock.id}">${wrappedstock.id}
				</t:pagelink>
			</p:idCell>
			<p:acquiredCell>
				<t:DateValue date="wrappedstock.stock.acquired" />
			</p:acquiredCell>
			<p:liquidatedCell>
				<t:DateValue date="wrappedstock.stock.liquidated" />
			</p:liquidatedCell>
			<p:actionsCell>
				<t:eventlink t:event="Merge" t:context="${wrappedstock.id}">${message:merge}
				</t:eventlink>
				<t:if test="${wrappedstock.liquidated}" negate="true">
					,
					<t:pagelink t:page="edit/LiquidateEditor" t:context="${wrappedstock.id}">${message:liquidate}
					</t:pagelink>
				</t:if>
			</p:actionsCell>
			<p:buyPriceCell>
				<div class="${wrappedStock.buyPriceClass}">
					${wrappedstock.buyPrice}
				</div>
			</p:buyPriceCell>
			<p:sellPriceCell>
				<div class="${wrappedStock.sellPriceClass}">
					${wrappedstock.sellPrice}
				</div>
			</p:sellPriceCell>
		</table>
	</t:if>

</html>
